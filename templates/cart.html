{% extends "template.html" %}

{% block title %}Cart - Boak's Store{% endblock %}

{% block rightHeader %}
    <link rel="stylesheet" href="/static/style/cart.css">
{% endblock %}

{% block content %}
<div class="cart-container">
    <div class="cart-header">
        <h1>Your Shopping Cart</h1>
        <a href="/" class="continue-shopping">Continue Shopping</a>
    </div>

    <div id="cart-items" class="cart-items-container"></div>

    <div class="cart-summary">
        <div class="total-row">
            <span>Subtotal</span>
            <span>$<span id="cart-total">0.00</span></span>
        </div>
        <button class="checkout-btn" onclick="window.location.href='/checkout'">Proceed to Checkout</button>
    </div>
</div>

<script>
    function renderCart() {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const cartItems = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        cartItems.innerHTML = '';
        let total = 0;

        cart.forEach(item => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;
            cartItems.innerHTML += `
                <div class="cart-item">
                    <img src="/static/img/${item.images[0]}" alt="${item.name}">
                    <h3>${item.name}</h3>
                    <p>$${item.price}</p>
                    <div class="quantity-selector">
                        <button onclick="updateCartQuantity(${item.id}, -1)">-</button>
                        <input type="number" value="${item.quantity}" readonly>
                        <button onclick="updateCartQuantity(${item.id}, 1)">+</button>
                    </div>
                    <p>$${itemTotal.toFixed(2)}</p>
                    <button onclick="removeFromCart(${item.id})">Remove</button>
                </div>
            `;
        });

        if (cart.length === 0) {
            cartItems.innerHTML = '<p>Your cart is empty</p>';
        }

        cartTotal.textContent = total.toFixed(2);
    }

    function updateCartQuantity(productId, change) {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const item = cart.find(i => i.id === productId);
        if (item) {
            item.quantity += change;
            if (item.quantity <= 0) {
                cart = cart.filter(i => i.id !== productId);
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        }
    }

    function removeFromCart(productId) {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        cart = cart.filter(item => item.id !== productId);
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
    }

    window.onload = renderCart;
</script>
{% endblock %}